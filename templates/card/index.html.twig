{% extends 'base.html.twig' %}

{% block title %}Mes cartes
{% endblock %}

{% block body %}
	<div class="container mx-auto py-8">
		<div class="flex justify-between items-center mb-6">
			<h1 class="text-3xl font-futuraMedium">Mes cartes</h1>
			<!-- Bouton pour créer une nouvelle carte -->
			<a href="{{ path('app_card_create') }}" class="text-white bg-green-500 px-4 py-2 rounded hover:bg-green-600">
				Créer une carte
			</a>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{% for card in cards %}
				<div class="p-6 bg-white rounded-lg shadow-md border relative" style="width: 350px;">
					{% if card.imagePath %}
						<div class="flex mt-4 w-full justify-center">
							<div class="relative group perspective-1500" style="width: 300px; height: auto;">
								<div class="card-content group-hover:scale-105 transition-all duration-300 ease-in-out relative">
									<p class="absolute font-futuraBold z-20 top-[14px] left-[56px] text-[18px]">{{ card.name }}</p>
									<p class="absolute font-futuraBold z-20 top-[12px] right-[40px] text-[10px]">pv<span class="text-[19px] tracking-tighter">{{ card.power }}</span>
									</p>

									<img src='/assets/template_cards/{{card.type.value}}.png' alt="{{ card.type.value }}.png" class="relative z-10 w-full h-auto">

									<img src="{{ asset('images/cards/' ~ card.imagePath) }}" alt="Image carte" class="absolute top-0 left-1/2 transform -translate-x-1/2 pt-6 w-[95%] h-auto rounded">
								</div>
							</div>

						</div>

					{% endif %}

					<div class="flex justify-between mt-4">
						<a href="{{ path('app_card_edit', { id: card.id }) }}" class="text-white bg-blue-500 px-4 py-2 rounded hover:bg-blue-600">
							Modifier
						</a>

						<!-- Bouton pour afficher la popup -->
						<button data-card-id="{{ card.id }}" data-csrf-token="{{ csrf_token('delete_card_' ~ card.id) }}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 show-delete-popup">
							Supprimer
						</button>
					</div>
				</div>
			{% endfor %}
		</div>

	</div>

	<!-- Popup de confirmation -->
	<div id="delete-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
		<div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
			<h2 class="text-xl font-semibold mb-4">Êtes-vous sûr de vouloir supprimer cette carte ?</h2>
			<div class="flex justify-end gap-4">
				<button id="cancel-delete" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
					Annuler
				</button>
				<!-- Formulaire de suppression -->
				<form id="delete-form" method="POST" class="inline-block">
					<input type="hidden" name="_token" value="">
					<button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
						Confirmer
					</button>
				</form>
			</div>
		</div>
	</div>

	<!-- JavaScript pour gérer la popup -->
	<script>
		console.log('Hello from the card index page!', cards);
document.querySelectorAll('.show-delete-popup').forEach(button => {
button.addEventListener('click', () => {
const popup = document.getElementById('delete-popup');
const form = document.getElementById('delete-form');
const cardId = button.getAttribute('data-card-id');
const csrfToken = button.getAttribute('data-csrf-token');

// Configure l'action du formulaire et le CSRF token
form.setAttribute('action', `/card/${cardId}/delete`);
form.querySelector('input[name="_token"]').value = csrfToken;

// Affiche la popup
popup.classList.remove('hidden');
});
});

document.getElementById('cancel-delete').addEventListener('click', () => {
const popup = document.getElementById('delete-popup');
popup.classList.add('hidden');
});
	</script>
{% endblock %}
